<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Remote</title>
        <meta name="description" content="" />
        <meta name="viewport" content="width=180, user-scalable=no" />
        <style type="text/css">
            html, body {
                margin:0;
                padding:0;
                background: #CCC;
                width:180px;
            }
            button {
                position: absolute;
                width: 60px;
                height: 60px;
                cursor: pointer;

                -webkit-user-select:none;
                -moz-user-select:none;
                -ms-user-select:none;
                user-select:none;
            }
            .left {
                margin-top:-30px;
                top:50%;
                left:10px;
            }
            .right {
                margin-top:-30px;
                top:50%;
                right:10px;
            }
            .top {
                margin-left:-30px;
                top:10px;
                left:50%;
            }
            .bottom {
                margin-left:-30px;
                bottom:10px;
                left:50%;
            }
        </style>
    </head>
    <body>
        <button class="left" data-key="37">&lt;</button>
        <button class="right" data-key="39">&gt;</button>
        <button class="top" data-key="38">^</button>
        <button class="bottom" data-key="40">v</button>

        <script type="text/javascript" src="/socket.io/socket.io.js"></script>
        <script type="text/javascript">
        var channel = location.pathname.split('/').pop();
        var socket = io.connect();

        socket.on('connect', function () {
            console.log('connected to channel', channel);
            socket.emit('join', {type:'remote', channel:channel});
        });

        var IGNORE = [16, 17, 18, 20];
        window.onkeyup = function(e) {
            e.preventDefault();

            var code = e.keyCode || e.which;
            if (IGNORE.indexOf(code) !== -1) return;

            console.info('Sending key', code, 'to', channel);
            socket.emit('event', { type:'key', code: code, channel:channel });
        };

        function sendButton() {
            var data = this.dataset;
            var code = parseInt(data.key) || (data.char || this.innerHTML).toLowerCase().charCodeAt(0);
            console.info('Sending button', code, 'to', channel);
            socket.emit('event', { type:'button', code: code, channel:channel });
        }
        
        var buttons = document.getElementsByTagName('button');
        for (var i = 0; i < buttons.length; i++) {
            var button = buttons[i];
            if ('ontouchstart' in button) {
                button.ontouchstart = sendButton;
            } else {
                button.onmousedown = sendButton;
            }
        }
        </script>
    </body>
</html>